#!/usr/bin/env ruby

require 'rubygems'
require 'thor'
require 'bundler'
require 'virtualbox'
require 'veewee'


   
class VeeweeCLI < Thor 
  
  desc "define [NAME] [TEMPLATE]", "initializes a box from a template" 
  method_options :force => :boolean
  def define(boxname=nil, template=nil)
    
    if (boxname.nil?)  
      puts "please provide a boxname"
      exit
    end
    
    puts "Init a new box #{boxname}, starting from template #{template}"
  	Veewee::Session.define(boxname,template)
  	
  end

  desc "templates", "list the template available" 
  def templates 
    Veewee::Session.list_templates
  end
  
  desc "build [NAME]", "build the box defined" 
  method_options :force => :boolean
  def build(boxname)
    puts "Building box #{boxname}"
    vs=Veewee::Session.new(options)
    vd=vs.get_definition(boxname)
    vs.build(boxname,vd)    
  end

  desc "export [NAME]", "export the box" 
  method_options :force => :boolean  
  def export(boxname)
      if (!boxname.nil?)
        Veewee::Session.export_box(boxname)
      end
  end
  
end



version=VirtualBox.version
if (version.match(/^4./))
   	VeeweeCLI.start
else
   	puts "veewee only supports VirtualBox 4.x"
end
